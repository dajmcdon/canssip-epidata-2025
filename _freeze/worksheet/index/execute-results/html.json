{
  "hash": "0559e4344a3d712217606cd1e72f91f3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Processing and Forecasting with Epidemic Surveillance Data\"\nsubtitle: \"CANSSI Prairies Workshop 2025\"\nauthor: \"CANSSI Prairies -- Epi modelling workshop\"\ndate: \"April 25, 2025\"\ntoc: true\nformat:\n  html:\n    page-layout: article\n---\n\n\n\nThe goal of this worksheet is to practice some of the techniques\ndiscussed during the lectures. The plan is to take a \"phased\" approach,\nwith 15-30 minutes of work after each of the four lectures. But the\nidea is to roughly continue on the same problem.\n\n## Computer setup\n\nThe following are packages needed for this worksheet. With luck, you\nwould need only a few more (perhaps none!) to build all the slides\nin this workshop. But I make no guarantees.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"remotes\")\ninstall.packages(\"tidyverse\")\ninstall.packages(\"tidymodels\")\ninstall.packages(\"glmnet\")\nremotes::install_github(\"cmu-delphi/epidatr\")\nremotes::install_github(\"cmu-delphi/epidatasets\")\nremotes::install_github(\"cmu-delphi/epiprocess@dev\")\nremotes::install_github(\"cmu-delphi/epipredict@dev\")\nremotes::install_github(\"dajmcdon/rtestim\")\n```\n:::\n\n\n\nNote that both `{epiprocess}` and `{epipredict}` are set to install from the \ndevelopment branch rather than from the main branch. So this is the most up-to-date\nversion, but it is also potentially unstable.\n\nThe best place for package documentation is typically the website rather than \nthe `R` help files. So some useful links are here:\n\n* <https://cmu-delphi.github.io/epidatr>\n* <https://cmu-delphi.github.io/epiprocess>\n* <https://cmu-delphi.github.io/epipredict>\n* <https://tidyverse.org>\n* <https://tidymodels.org>\n* <https://dajmcdon.github.io/rtestim>\n\n\n## Lecture 1: Introduction to Panel Data in Epidemiology\n\nLet's examine two different sources of versioned panel data. \n\n### Source 1: Respiratory Virus Detection Surveillance System\n\nNavigate to the Dashboard maintained by the Public Health Agency of Canada:\n<https://health-infobase.canada.ca/respiratory-virus-detections/>. Let's focus\non Figure 4.\n\n1. When was it last updated?\n2. What is the reference date for the most recent data?\n3. What geographic regions are available for different data streams?\n4. Are the revisions tracked?\n\n### Source 2: Delphi Epi Portal\n\n1. Browse the table.\n2. What sorts of signals are available?\n3. For what regions?\n4. Select a signal with at least state-level geographic coverage that is \"Ongoing\" (For example, \"Covid-Related Doctor Visits\")\n5. Are revisions tracked?\n6. What sort of latency does it have?\n\n### Extra credit\n\n1. Download this season's RVDSS data. This is most easily done by following the \ninstructions at <https://github.com/dajmcdon/rvdss-canada>. (My team scrapes the\ndata weekly. Just use the `R` code at the bottom of the README to \"Read in data for a single season\")\n1. Download the signal from the Delphi Epidata API that you chose above using `{epidatr}`.\n1. Explore and examine both signals using graphics or summary statistics. \n\n## Lecture 2: Data Cleaning, Versioning, and Nowcasting\n\n1. If you didn't get a chance earlier, download this season's RVDSS data.\n1. Filter to only those rows with `geo_type != \"province\"`. (This is a bit of a\nmisnomer, we're keeping some provinces and some regions.)\n1. Convert it to an `epi_archive` with `as_epi_archive()`.\n1. Examine the revision behaviour for one of the signals. The best way is with a plot. \n(Unfortunately, `revision_summary()` won't work for the moment.)\n1. Is there much backfill? Latency?\n1. Use `epix_as_of_current()` to get the most recent snapshot.\n1. Let's look at just `flu_pct_positive`. Calculate the average correlation across\ngeographies at lag 7 and lag 14. \n1. Calculate the correlation between `flu_pct_positive` and `sarscov2_pct_positive` \nover time and plot the result.\n\nIf there's still time, try to calculate the growth rate for `flu_pct_positive`.\n\n## Lecture 3: \n\nHere's a modified version of the SIR simulation function that returns only\nthe new infections:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsim_SIR <- function(TT, N = 1000, beta = .1, gamma = .01) {\n  S <- double(TT)\n  I <- double(TT)\n  R <- double(TT)\n  S[1] <- N - 1\n  I[1] <- 1\n  i <- double(TT)\n  i[1] <- 1\n  for (tt in 2:TT) {\n    contagions <- rbinom(1, size = S[tt - 1], prob = beta * I[tt - 1] / N)\n    removals <- rbinom(1, size = I[tt - 1], prob = gamma)\n    S[tt] <- S[tt - 1] - contagions\n    I[tt] <- I[tt - 1] + contagions - removals\n    R[tt] <- R[tt - 1] + removals\n    i[tt] <- contagions\n  }\n  tibble(infections = i, time = seq(TT))\n}\n```\n:::\n\n\n\n1. Continuing with the RVDSS data (most recent snapshot), make a plot of \n`flu_positive_tests` for your favourite region.\n1. Adjust the parameters `N`, `beta`, and `gamma` to calibrate an SIR model\nthat fits the data closely.\n1. Use `{rtestim}` to estimate $R_t$ for your favourite region.\n\n## Lecture 4: Forecasting and Advanced Topics\n\n\n1. Continuing with the RVDSS data (most recent snapshot), use `arx_forecaster()`\nto produce forecasts 1, 2, and 3 weeks after of the most recent data for \n`flu_pct_positive`.\n1. You can plot them as follows (for example):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nh1 <- arx_forecaster(rvdss, ..., args_list = arx_args_list(ahead = 7))\nautoplot(h1)\n```\n:::\n\n\n3. Adjust the arguments however you like. You can add other predictors, adjust\nlags, change forecasting engines, etc.\n\nIf you have time, try \"Building a forecaster from scratch\" this is more difficult\nto plot, but you can borrow the code from the lecture slides.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}